// EditableTable.scss - Contemporary styling for reusable table component
// Compatible with WordPress block themes and your existing patterns

.sv-editable-table-container {
	// Container for one or more tables
	.sv-editable-table + .sv-editable-table {
		margin-top: 24px; // Space between grouped tables
	}

	/* Main EditableTable Component */
	.sv-editable-table {
		background: white;
		border-radius: 12px;
		box-shadow:
			0 1px 3px 0 rgb(0 0 0 / 0.1),
			0 1px 2px -1px rgb(0 0 0 / 0.1);
		overflow-y: scroll;
		margin-bottom: 24px;
		max-height: 80vh; // Set max height for the table
		display: flex;
		flex-direction: column;

		&:last-child {
			margin-bottom: 0;
		}
	}

	/* Header */
	.sv-table-header {
		background: white;
		border-bottom: 1px solid #e2e8f0;
		padding: 20px 24px;
		display: flex;
		justify-content: space-between;
		align-items: center;
		flex-shrink: 0; // Don't shrink
	}


	.sv-table-header-cell,
	.sv-table-field {


		&.flex-0 {
			display: none; // Hide by default
		}
		&.flex-1 {
			flex: 1;
			min-width: 0;
		}
		&.flex-auto {
			flex: 0 0 auto;
		}
		&.flex-2 {
			flex: 2; // Twice as wide as flex-1
			min-width: 0;
		}

		&.flex-3 {
			flex: 3; // Three times as wide as flex-1
			min-width: 0;
		}
		&.flex-4 {
			flex: 4; // Four times as wide as flex-1
			min-width: 0;
		}
		&.flex-5 {
			flex: 5; // Five times as wide as flex-1
			min-width: 0;
		}
		&.flex-6 {
			flex: 6; // Six times as wide as flex-1
			min-width: 0;
		}
		&.flex-7 {
			flex: 7; // Seven times as wide as flex-1
			min-width: 0;
		}
		&.flex-8 {
			flex: 8; // Eight times as wide as flex-1
			min-width: 0;
		}
		&.flex-9 {
			flex: 9; // Nine times as wide as flex-1
			min-width: 0;
		}
		&.flex-10 {
			flex: 10; // Ten times as wide as flex-1
			min-width: 0;
		}

		&.width-100 {
			flex: 0 0 100px; // Fixed 100px width
		}

		&.width-150 {
			flex: 0 0 150px; // Fixed 150px width
		}

		&.width-200 {
			flex: 0 0 200px; // Fixed 200px width
		}
	}

	.sv-table-header-rows {
		position: sticky;
		top: 0;
		z-index: 50; // Lower than column headers
	}

	.sv-table-column-headers {
		display: flex;
		gap: 20px;
		padding: 12px 24px;
		background: #f8fafc;
		border-bottom: 1px solid #e2e8f0;
		font-size: 12px;
		font-weight: 600;
		color: #64748b;
		text-transform: uppercase;
		letter-spacing: 0.05em;
		position: sticky;
		top: 0;
		z-index: 10;
		flex-shrink: 0; // Don't shrink
	}

	.sv-table-title {
		font-size: 18px;
		font-weight: 600;
		color: #1a0640 !important;
		margin: 0;
	}

	.sv-row-actions,
	.sv-table-header-cell.actions {
		width: 120px; // Fixed width for action buttons
		justify-content: center;
		text-align: center;
	}

	.sv-table-actions {
		display: flex;
		gap: 12px;
		align-items: center;
	}

	/* Buttons */
	.sv-btn {
		display: inline-flex;
		align-items: center;
		gap: 8px;
		padding: 8px 16px;
		border: 1px solid transparent;
		border-radius: 8px;
		font-size: 14px;
		font-weight: 500;
		cursor: pointer;
		transition: all 0.15s ease;
		text-decoration: none;
		outline: none;
		background: none;

		&:focus {
			box-shadow: 0 0 0 3px rgb(59 130 246 / 0.1);
		}

		&:disabled {
			opacity: 0.6;
			cursor: not-allowed;
		}

		// Icon sizing
		.icon,
		svg {
			width: 16px;
			height: 16px;
			fill: currentColor;
		}

		.icon-plus {
			width: 14px;
			height: 14px;
		}
	}

	.sv-btn-primary {
		background: #3b82f6;
		color: white;

		&:hover:not(:disabled) {
			background: #2563eb;
		}
	}

	.sv-btn-edit {
		transform: rotateZ(90deg);
	}

	.sv-btn-secondary {
		background: white;
		color: #64748b;
		border-color: #e2e8f0;

		&:hover:not(:disabled) {
			background: #f8fafc;
			border-color: #cbd5e1;
		}
	}

	.sv-btn-secondary.sv-editable-table-save-btn {
		background: linear-gradient(
			0deg,
			rgb(140, 201, 197) 0%,
			rgb(171, 181, 214) 100%
		);
		color: white;

		&:hover:not(:disabled) {
			background: linear-gradient(
				0deg,
				rgb(96 156 152) 0%,
				rgb(84 98 144) 100%
			);
			transform: scale(1.05);
		}
	}

	.sv-btn-danger {
		background: #ef4444;
		color: white;
		width: 32px;
		height: 32px;
		padding: 0;
		border-radius: 50%;
		justify-content: center;

		&:hover:not(:disabled) {
			background: #dc2626;
		}
	}

	.sv-btn-small {
		padding: 6px 12px;
		font-size: 13px;
	}

	.sv-btn-add-row {
		font-size: 1.5em;
		padding: 0.1em 0.6em;
		border-radius: 2em;
		background: #8cc9c56e;
		color: #ffffff;
		text-align: center;
		align-items: center;

		&:hover:not(:disabled) {
			background: #8cc9c5e5;
			transform: none;
		}
	}

	/* Group Headers */
	.sv-group-header {
		background: #f1f5f9;
		color: #475569;
		padding: 16px 24px;
		font-size: 16px;
		font-weight: 600;
		border-bottom: 1px solid #e2e8f0;
		margin: 0;
	}

	/* Totals row styling */
	.sv-totals-row {
		background: #f8fafc;
		border-top: 2px solid #e2e8f0;
		font-weight: 600;

		.sv-field-value {
			font-weight: 600;
			color: #0f172a;
		}

		&:hover {
			background: #f8fafc; // Don't change on hover
		}
	}

	.sv-totals-value {
		font-size: 15px;
		font-weight: 600;
		color: #0f172a;

		// Special styling for numeric totals
		&:has-text {
			text-align: right;
		}
	}

	/* Table Rows */
	.sv-table-row {
		padding: 20px 24px;
		border-bottom: 1px solid #f1f5f9;
		display: flex;
		align-items: center;
		gap: 20px;
		transition: background-color 0.15s ease;

		&:hover {
			background: #f8fafc;
		}

		&:last-child {
			border-bottom: none;
		}

		&.editing {
			background: #fefce8;
			border-left: 4px solid #eab308;
		}

		&.inactive {
			opacity: 0.1;
			filter: saturate(0);
		}
	}

	/* Group Section Headers - inside table rows */
	.sv-group-section-header {
		background: #f1f5f9;
		color: #475569;
		padding: 12px 24px;
		font-size: 14px;
		font-weight: 600;
		text-transform: uppercase;
		letter-spacing: 0.05em;
		border-bottom: 2px solid #e2e8f0;
		border-top: 1px solid #e2e8f0;
		margin: 0;
		position: sticky;
		top: 0;
		z-index: 5; // Lower than column headers

		/* NEW: Match table row layout */
		display: flex;
		align-items: center;
		gap: 20px;

		&:first-child {
			border-top: none;
		}

		&:not(:first-child) {
			margin-top: 16px;
			border-top: 2px solid #cbd5e1;
		}

		/* NEW: Header content spans data columns */
		.sv-group-header-content {
			flex: 1;
		}
	}

	/* Group subtitle styling */
	.sv-group-subtitle {
		font-size: 13px;
		font-weight: 400;
		text-transform: none;
		letter-spacing: normal;
		color: #64748b;
		margin: 4px 0 0 0;
		line-height: 1.4;
	}

	/* NEW: Actions column matches table row actions */
	.sv-group-actions {
		width: 120px; // Same as .sv-row-actions
		display: flex;
		justify-content: center;
		flex-shrink: 0;

		.sv-btn {
			.icon {
				width: 14px;
				height: 14px;
			}
		}
	}

	// Ensure rows after group headers have proper spacing
	.sv-group-section-header + .sv-table-row {
		border-top: none;
	}

	/* Custom scrollbar styling */
	.sv-editable-table::-webkit-scrollbar {
		width: 8px;
	}

	.sv-editable-table::-webkit-scrollbar-track {
		background: transparent;
	}

	.sv-editable-table::-webkit-scrollbar-thumb {
		background: linear-gradient(
			0deg,
			rgba(140, 201, 197, 0.325) 0%,
			rgba(171, 181, 214, 0.325) 100%
		);
	}

	// Dark mode support
	@media (prefers-color-scheme: dark) {
		.sv-group-section-header {
			background: #334155;
			color: #cbd5e1;
			border-bottom-color: #475569;
			border-top-color: #475569;

			&:not(:first-child) {
				border-top-color: #64748b;
			}
		}
	}

	/* Fields */
	.sv-table-field {
		display: flex;
		flex-direction: column;
		gap: 6px;
	}

	.sv-field-label {
		font-size: 12px;
		font-weight: 500;
		color: #64748b;
		text-transform: uppercase;
		letter-spacing: 0.05em;
		margin-bottom: 2px;
	}

	.sv-field-value {
		font-size: 15px;
		color: #0f172a;
		word-break: break-word;
		line-height: 1.4;
	}

	/* Form Inputs */
	.sv-field-input {
		width: 90%;
		padding: 10px 12px;
		border: 1px solid #d1d5db;
		border-radius: 8px;
		font-size: 14px;
		background: white;
		transition: all 0.15s ease;
		color: #1e293b;
		font-family: inherit;

		&:focus {
			outline: none;
			border-color: #3b82f6;
			box-shadow: 0 0 0 3px rgb(59 130 246 / 0.1);
		}

		&::placeholder {
			color: #9ca3af;
		}

		&.number {
			width: 80%;
			text-align: center;
		}

		&.textarea {
			min-height: 80px;
			resize: vertical;
			line-height: 1.5;
		}

		&.checkbox:focus {
			box-shadow: none;
		}

		// Select specific styling
		&[type="select"] {
			cursor: pointer;
			background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='m6 8 4 4 4-4'/%3e%3c/svg%3e");
			background-position: right 8px center;
			background-repeat: no-repeat;
			background-size: 16px;
			padding-right: 32px;
		}
	}

	// Separate selector for select elements
	select.sv-field-input {
		cursor: pointer;
		background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='m6 8 4 4 4-4'/%3e%3c/svg%3e");
		background-position: right 8px center;
		background-repeat: no-repeat;
		background-size: 16px;
		padding-right: 32px;
	}

	/* Row Actions */
	.sv-row-actions {
		display: flex;
		gap: 8px;
		align-items: flex-start;
		flex-shrink: 0;
	}

	/* Empty State */
	.sv-table-empty {
		padding: 60px 24px;
		text-align: center;
		color: #64748b;
	}

	.sv-table-empty-icon {
		width: 48px;
		height: 48px;
		margin: 0 auto 16px;
		color: #cbd5e1;
	}

	.sv-table-empty-title {
		font-size: 16px;
		font-weight: 500;
		color: #475569;
		margin-bottom: 8px;
	}

	.sv-table-empty-text {
		font-size: 14px;
		color: #64748b;
	}

	/* Loading State */
	.sv-table-loading {
		padding: 0px 10px 30px;
		text-align: center;
		color: #64748b;
		font-style: italic;
		display: flex;
		justify-content: center;
		align-items: center;
		margin: 2em;
	}

	.sv-field-value.zero-value {
		opacity: 0;
	}

	/* Badges */
	.sv-badge {
		display: inline-flex;
		align-items: center;
		padding: 4px 10px;
		border-radius: 20px;
		font-size: 12px;
		font-weight: 500;
		background: #f1f5f9;
		color: #475569;
		text-transform: capitalize;

		&.success {
			background: #dcfce7;
			color: #166534;
		}

		&.warning {
			background: #fef3c7;
			color: #92400e;
		}

		&.danger {
			background: #fee2e2;
			color: #991b1b;
		}

		&.info {
			background: #dbeafe;
			color: #1e40af;
		}

		/* CSS for calculated fields */

		.sv-field-value.calculated {
			background-color: #e8f4f8;
			border: 1px solid #bee5eb;
			padding: 8px;
			border-radius: 4px;
			color: #0c5460;
			font-weight: 500;
		}

		/* Alternative: Use formula icon */
		.sv-field-value.calculated::before {
			content: "fx ";
			font-weight: bold;
			font-style: italic;
			margin-right: 4px;
			color: #0c5460;
		}

		/* Style calculated column headers */
		.sv-table-header-cell.calculated {
			background-color: #e8f4f8;
			color: #0c5460;
			font-weight: 600;
		}

		/* Highlight calculated fields during editing */
		.sv-table-row.editing .sv-field-value.calculated {
			box-shadow: 0 0 0 2px rgba(13, 202, 240, 0.25);
		}
	}

	/* HTML: <div class="loader"></div> */
	.sv-table-loader {
		width: 50px;
		aspect-ratio: 1;
		border: 2px solid;
		box-sizing: border-box;
		border-radius: 50%;
		display: grid;
		animation: l11 1.5s infinite linear;
		transform-origin: 50% 80%;
		color: #8cc9c5af;
	}
	.sv-table-loader:before,
	.sv-table-loader:after {
		content: "";
		grid-area: 1/1;
		border: inherit;
		border-radius: 50%;
		animation: inherit;
		animation-duration: 1s;
		transform-origin: inherit;
	}
	.sv-table-loader:after {
		--s: -1;
	}
	@keyframes l11 {
		100% {
			transform: rotate(calc(var(--s, 1) * 1turn));
		}
	}

	/* Responsive Design */
	/* Mobile responsive - card layout */
	@media (max-width: 768px) {
		.sv-editable-table {
			max-height: none; // Remove height restriction on mobile
		}

		.sv-table-header {
			flex-direction: column;
			align-items: stretch;
			gap: 16px;
			padding: 16px 20px;
		}

		.sv-table-actions {
			justify-content: center;
		}

		/* Hide column headers on mobile */
		.sv-table-column-headers {
			display: none;
		}

		/* Convert rows to cards */
		.sv-table-row {
			flex-direction: column;
			align-items: stretch;
			gap: 12px;
			padding: 16px 20px;
			border: 1px solid #e2e8f0;
			border-radius: 8px;
			margin-bottom: 12px;
			background: white;

			&:last-child {
				margin-bottom: 0;
			}

			&.editing {
				border-left: 4px solid #eab308;
				background: #fefce8;
			}
		}

		.sv-row-actions,
		.sv-table-header-cell.actions {
			justify-content: flex-end;
		}

		/* Show field labels again on mobile */
		.sv-table-field {
			width: 100%;

			&.flex-1,
			&.flex-auto {
				flex: none;
			}

			/* Bring back labels for mobile */
			.sv-field-label {
				display: block;
				font-size: 12px;
				font-weight: 500;
				color: #64748b;
				text-transform: uppercase;
				letter-spacing: 0.05em;
				margin-bottom: 4px;
			}
		}

		.sv-totals-row {
			.sv-field-label {
				display: none;
			}
			.sv-field-label.sum-field {
				display: block;
			}
		}

		.sv-field-input {
			&.number {
				width: 90%;
				text-align: left;
			}
		}

		.sv-row-actions {
			justify-content: flex-end;
			margin-top: 12px;
			padding-top: 12px;
			border-top: 1px solid #f1f5f9;
			flex-direction: row;
			gap: 8px;
			width: 100%;
		}

		.sv-group-section-header {
			padding: 12px 20px;
			font-size: 15px;
			position: static; // Remove sticky on mobile
			margin: 16px 0 8px 0;
			border-radius: 6px;
		}

		.sv-table-rows {
			padding: 0 20px;
			overflow-y: visible; // Remove scroll on mobile
		}

		.sv-group-title {
			font-size: 15px;
		}

		.sv-group-subtitle {
			font-size: 12px;
		}

		.sv-group-actions {
			justify-content: flex-end;

			.sv-btn {
				justify-content: center;
			}
		}
	}

	/* Hide labels on desktop */
	@media (min-width: 769px) {
		.sv-field-label {
			display: none;
		}
	}

	/* Dark mode support (if your theme supports it) */
	@media (prefers-color-scheme: dark) {
		.sv-editable-table {
			background: #1e293b;

			.sv-table-header {
				background: #1e293b;
				border-color: #334155;
			}

			.sv-table-title {
				color: #f1f5f9;
			}

			.sv-group-header {
				background: #334155;
				color: #cbd5e1;
				border-color: #475569;
			}

			.sv-group-header-content {
				display: flex;
				justify-content: space-between;
				align-items: center;
				gap: 16px;
			}

			.sv-group-header-text {
				flex: 1;
			}

			.sv-table-row {
				border-color: #334155;

				&:hover {
					background: #334155;
				}

				&.editing {
					background: #451a03;
					border-left-color: #f59e0b;
				}
			}

			.sv-field-label {
				color: #94a3b8;
			}

			.sv-field-value {
				color: #f1f5f9;
			}

			.sv-field-input {
				background: #334155;
				border-color: #475569;
				color: #f1f5f9;

				&:focus {
					border-color: #3b82f6;
				}

				&::placeholder {
					color: #64748b;
				}
			}

			.sv-btn-secondary {
				background: #334155;
				color: #cbd5e1;
				border-color: #475569;

				&:hover:not(:disabled) {
					background: #475569;
				}
			}

			.sv-table-empty,
			.sv-table-loading {
				color: #94a3b8;
			}

			.sv-table-empty-title {
				color: #cbd5e1;
			}
			.sv-group-subtitle {
				color: #94a3b8;
			}
		}
	}
}

// /* WordPress admin compatibility */
// .wp-admin {
//     .sv-editable-table {
//         font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
//     }
// }

// /* Block editor specific styles */
// .block-editor-block-list__layout {
//     .sv-editable-table {
//         // Ensure proper spacing in block editor
//         .sv-table-header {
//             position: relative;
//         }

//         // Prevent editor interference
//         .sv-field-input {
//             &:focus {
//                 z-index: 1;
//                 position: relative;
//             }
//         }
//     }
// }
